// Next.js API route support: https://nextjs.org/docs/api-routes/introduction

const options = {
  method: "GET",
  headers: {
    "X-RapidAPI-Key": "422754484emsh3e47e476be0d92cp12bc35jsn60b5c02b8500",
    "X-RapidAPI-Host": "coinranking1.p.rapidapi.com",
  },
};
const testdata = [
  {
    uuid: "Qwsogvtv82FCd",
    symbol: "BTC",
    name: "Bitcoin",
    color: "#f7931A",
    iconUrl: "https://cdn.coinranking.com/bOabBYkcX/bitcoin_btc.svg",
    marketCap: "523029441955",
    price: "27213.248700970904",
    listedAt: 1330214400,
    tier: 1,
    change: "-2.32",
    rank: 1,
    sparkline: [
      "27845.008047979336",
      "27866.86186033572",
      "27866.147228496407",
      "27877.450300445333",
      "27854.379400214697",
      "27869.25181907092",
      "28016.578953596934",
      "28051.894826602766",
      "28015.193716121426",
      "27934.608962177546",
      "27920.254664668522",
      "27930.156434933167",
      "27947.321955859315",
      "27881.63334381788",
      "27830.0047629931",
      "27853.154580324386",
      "27851.195565116694",
      "27906.365956822214",
      "27946.39195581777",
      "27959.950823979107",
      "27909.72625648141",
      "27830.462858757615",
      "27762.62928363226",
      "27330.48099147671",
      "27059.50947646969",
    ],
    lowVolume: false,
    coinrankingUrl: "https://coinranking.com/coin/Qwsogvtv82FCd+bitcoin-btc",
    "24hVolume": "15961800532",
    btcPrice: "1",
  },
  {
    uuid: "razxDUgYGNAdQ",
    symbol: "ETH",
    name: "Ethereum",
    color: "#3C3C3D",
    iconUrl: "https://cdn.coinranking.com/rk4RKHOuW/eth.svg",
    marketCap: "210649461081",
    price: "1726.267882864389",
    listedAt: 1438905600,
    tier: 1,
    change: "-2.33",
    rank: 2,
    sparkline: [
      "1766.0096502877998",
      "1768.7485660120988",
      "1769.3985766375247",
      "1769.4345868685648",
      "1765.5007362385588",
      "1764.8073643031328",
      "1774.9218920037542",
      "1778.7358104940831",
      "1779.7005571832274",
      "1771.0226402779213",
      "1768.1714254961264",
      "1768.1130182139373",
      "1768.541696762285",
      "1762.9287565717834",
      "1757.0775103762544",
      "1755.854647606495",
      "1755.6339581095797",
      "1760.5857160094663",
      "1764.9857757199331",
      "1768.180857383358",
      "1767.4915581854184",
      "1761.4780642116932",
      "1759.090890211356",
      "1738.2497377719426",
      "1719.3579348246603",
    ],
    lowVolume: false,
    coinrankingUrl: "https://coinranking.com/coin/razxDUgYGNAdQ+ethereum-eth",
    "24hVolume": "8769997277",
    btcPrice: "0.06343483285782046",
  },
  {
    uuid: "HIVsRcGKkPFtW",
    symbol: "USDT",
    name: "Tether USD",
    color: "#22a079",
    iconUrl: "https://cdn.coinranking.com/mgHqwlCLj/usdt.svg",
    marketCap: "65351928771",
    price: "0.9998354989101468",
    listedAt: 1420761600,
    tier: 1,
    change: "-0.33",
    rank: 3,
    sparkline: [
      "1.0026878902715148",
      "1.0014148627284662",
      "1.0020607549674732",
      "1.0017734393766364",
      "1.0029721393499103",
      "1.001675165282036",
      "1.00002693653045",
      "1.001578026124273",
      "1.0017907225420561",
      "1.0034093191509155",
      "1.0020780690072184",
      "1.0015085541148891",
      "1.0015773496378295",
      "1.0030827460118217",
      "1.0022385809699879",
      "1.0018018516735634",
      "1.0015992916256524",
      "1.001019573958214",
      "1.0012311953111628",
      "1.0012160207049856",
      "1.0014509745608382",
      "1.0027184269691523",
      "1.002876495589067",
      "1.0079804594529322",
      "1.0046625799610602",
    ],
    lowVolume: false,
    coinrankingUrl: "https://coinranking.com/coin/HIVsRcGKkPFtW+tetherusd-usdt",
    "24hVolume": "76464507066",
    btcPrice: "0.000036740762188914",
  },
  {
    uuid: "WcwrkfNI4FUAe",
    symbol: "BNB",
    name: "BNB",
    color: "#e8b342",
    iconUrl: "https://cdn.coinranking.com/B1N19L_dZ/bnb.svg",
    marketCap: "44769438461",
    price: "313.4775489409097",
    listedAt: 1503014400,
    tier: 1,
    change: "-4.29",
    rank: 4,
    sparkline: [
      "327.3060794775204",
      "327.7397179324875",
      "328.1968949227423",
      "328.040896890807",
      "327.9191418551915",
      "328.15519836575",
      "328.5946732512558",
      "329.3468578541465",
      "329.1673717954073",
      "328.6607928211409",
      "328.94503375133786",
      "328.632243410227",
      "328.86844489027084",
      "328.9426124247248",
      "328.0830233860538",
      "327.20012704539573",
      "327.28843486031343",
      "328.1212218172212",
      "328.61526084753586",
      "328.7317559713179",
      "329.13806672087645",
      "329.1700296412385",
      "328.682948813584",
      "325.1002780354993",
      "316.4615177327847",
    ],
    lowVolume: false,
    coinrankingUrl: "https://coinranking.com/coin/WcwrkfNI4FUAe+bnb-bnb",
    "24hVolume": "573274226",
    btcPrice: "0.011519299014443858",
  },
  {
    uuid: "aKzUVe4Hh_CON",
    symbol: "USDC",
    name: "USDC",
    color: "#7894b4",
    iconUrl: "https://cdn.coinranking.com/jkDf8sQbY/usdc.svg",
    marketCap: "43716901669",
    price: "0.9986049161726102",
    listedAt: 1539043200,
    tier: 1,
    change: "-0.31",
    rank: 5,
    sparkline: [
      "1.0016103132671332",
      "1.0004561353759347",
      "1.0009651241865265",
      "1.0007610540118026",
      "1.001812782848861",
      "1.0006952316660531",
      "0.9990843849053752",
      "1.0005224164366224",
      "1.0008560675401468",
      "1.0023352934573444",
      "1.001139743498298",
      "1.0005506711975507",
      "1.0004681552349666",
      "1.0019119389728344",
      "1.0013355169003282",
      "1.000794829785924",
      "1.0006134142394385",
      "0.9999853878101581",
      "1.000273263945507",
      "1.0002533305975672",
      "1.0005668746270273",
      "1.0018013880952605",
      "1.001790353418651",
      "1.0067209334349687",
      "1.0040884400584",
    ],
    lowVolume: false,
    coinrankingUrl: "https://coinranking.com/coin/aKzUVe4Hh_CON+usdc-usdc",
    "24hVolume": "3517584839",
    btcPrice: "0.000036695542202463",
  },
  {
    uuid: "-l8Mn2pVlRs-p",
    symbol: "XRP",
    name: "XRP",
    color: "#000000",
    iconUrl: "https://cdn.coinranking.com/B1oPuTyfX/xrp.svg",
    marketCap: "23325124926",
    price: "0.4637318346777076",
    listedAt: 1421798400,
    tier: 1,
    change: "3.59",
    rank: 6,
    sparkline: [
      "0.4474049040140254",
      "0.44856571520830957",
      "0.4479034059020209",
      "0.4487235513377492",
      "0.44606830338735354",
      "0.44670000709256347",
      "0.4498711664165742",
      "0.4499868505044063",
      "0.45011107433314107",
      "0.4462844327240877",
      "0.4509669285728152",
      "0.45453798722796873",
      "0.4561925999836538",
      "0.4537264519432765",
      "0.45621982826296537",
      "0.4580668119415386",
      "0.4651172900172686",
      "0.4664719365019237",
      "0.4672303919078879",
      "0.46647124644923416",
      "0.4799617395739452",
      "0.4830029052687576",
      "0.4818951847872909",
      "0.4721592290074136",
      "0.4637464898762961",
    ],
    lowVolume: false,
    coinrankingUrl: "https://coinranking.com/coin/-l8Mn2pVlRs-p+xrp-xrp",
    "24hVolume": "2483692308",
    btcPrice: "0.000017040664265166",
  },
  {
    uuid: "qzawljRxB5bYu",
    symbol: "ADA",
    name: "Cardano",
    color: "#3cc8c8",
    iconUrl: "https://cdn.coinranking.com/ryY28nXhW/ada.svg",
    marketCap: "12088984529",
    price: "0.34495583802106083",
    listedAt: 1506902400,
    tier: 1,
    change: "-3.02",
    rank: 7,
    sparkline: [
      "0.35433149584540663",
      "0.35528043972099577",
      "0.3560819660488069",
      "0.35570377896032407",
      "0.35443495847039985",
      "0.3544906110530835",
      "0.3561224927417002",
      "0.35685978839679555",
      "0.3554593106153415",
      "0.35231994735216493",
      "0.3527354113896075",
      "0.3527595377406188",
      "0.35264902276040117",
      "0.3508200853818496",
      "0.3492919455586973",
      "0.3494341592246866",
      "0.34924256229591943",
      "0.35085034884804317",
      "0.3517103035558391",
      "0.35197286137376493",
      "0.3538763361867007",
      "0.35477062735074943",
      "0.3547956457372954",
      "0.34965204107197606",
      "0.3442241850032156",
    ],
    lowVolume: false,
    coinrankingUrl: "https://coinranking.com/coin/qzawljRxB5bYu+cardano-ada",
    "24hVolume": "363123343",
    btcPrice: "0.000012676025630441",
  },
  {
    uuid: "PDKcptVnzJTmN",
    symbol: "OKB",
    name: "OKB",
    color: "#2d60e0",
    iconUrl: "https://cdn.coinranking.com/xcZdYtX6E/okx.png",
    marketCap: "10309914642",
    price: "42.699114726057374",
    listedAt: 1538524800,
    tier: 1,
    change: "1.45",
    rank: 8,
    sparkline: [
      "42.05558038926899",
      "42.08039135706658",
      "42.02678464807249",
      "42.039901661995515",
      "42.000772216158374",
      "41.89058873353769",
      "41.97759053168034",
      "42.14712065897311",
      "42.1152231143371",
      "41.879494249474575",
      "41.908753478338674",
      "42.00554295728772",
      "42.0971182987125",
      "42.00408071254459",
      "41.98475198575115",
      "41.91910635559983",
      "41.981414765345846",
      "43.105594008060244",
      "43.3144924006781",
      "43.710263664565666",
      "43.35604816042265",
      "43.34239039346528",
      "43.21444700579444",
      "42.50763491141739",
      "42.5325160710194",
    ],
    lowVolume: false,
    coinrankingUrl: "https://coinranking.com/coin/PDKcptVnzJTmN+okb-okb",
    "24hVolume": "35663241",
    btcPrice: "0.001569056131270868",
  },
  {
    uuid: "a91GCGd_u96cF",
    symbol: "DOGE",
    name: "Dogecoin",
    color: "#c2a633",
    iconUrl: "https://cdn.coinranking.com/H1arXIuOZ/doge.svg",
    marketCap: "9999410605",
    price: "0.07307494364178589",
    listedAt: 1391212800,
    tier: 1,
    change: "-1.62",
    rank: 9,
    sparkline: [
      "0.07433399040061377",
      "0.07454953408196917",
      "0.07453113152435328",
      "0.07431115416218778",
      "0.07403101666263857",
      "0.0740955327522808",
      "0.07443568957341992",
      "0.07457890858910443",
      "0.07446996190695722",
      "0.07393565560913037",
      "0.07382233471779652",
      "0.07384009284373165",
      "0.07393401589783641",
      "0.07374683965333201",
      "0.07346410576076016",
      "0.07351625792888185",
      "0.07351044252556231",
      "0.07358006594109039",
      "0.07368580719990243",
      "0.07388452428479236",
      "0.07449111304194432",
      "0.07555067318920312",
      "0.07533139128404528",
      "0.0738920923039559",
      "0.07303816357428272",
    ],
    lowVolume: false,
    coinrankingUrl: "https://coinranking.com/coin/a91GCGd_u96cF+dogecoin-doge",
    "24hVolume": "465327978",
    btcPrice: "0.000002685270856294",
  },
  {
    uuid: "uW2tk-ILY0ii",
    symbol: "MATIC",
    name: "Polygon",
    color: "#8247e5",
    iconUrl: "https://cdn.coinranking.com/M-pwilaq-/polygon-matic-logo.svg",
    marketCap: "9573436963",
    price: "1.055358003047996",
    listedAt: 1558961160,
    tier: 1,
    change: "-3.57",
    rank: 10,
    sparkline: [
      "1.0927814274006593",
      "1.0964623725608182",
      "1.0977278223708051",
      "1.0999791546865234",
      "1.097975350505243",
      "1.1003841757029833",
      "1.1080389678901363",
      "1.108477951777964",
      "1.1058661092640119",
      "1.0981391919561732",
      "1.0943890236610054",
      "1.0950010418009997",
      "1.0964917813458932",
      "1.0942899483238067",
      "1.0849650204538628",
      "1.0815193863380397",
      "1.0790929705064582",
      "1.0813057273221633",
      "1.0814346240074717",
      "1.0838376501509441",
      "1.0845507092284097",
      "1.0793232301169775",
      "1.0801625527494427",
      "1.0643986255221884",
      "1.0521930863818394",
    ],
    lowVolume: false,
    coinrankingUrl: "https://coinranking.com/coin/uW2tk-ILY0ii+polygon-matic",
    "24hVolume": "392857481",
    btcPrice: "0.000038781036936995",
  },
];

export default async function handler(req, res) {
  //res.status(200).send(testdata);
  const data = await fetch(
    `https://coinranking1.p.rapidapi.com/coins?referenceCurrencyUuid=${process.env.NEXT_PUBLIC_REFERENCE_CURRENCY_UUID}&timePeriod=24h&tiers%5B0%5D=1&orderBy=marketCap&orderDirection=desc&limit=10&offset=0`,
    options
  );
  const json = await data.json();
  if (json.status == "fail") {
    res.status(200).send({ error: true });
  } else {
    res.status(200).send(json.data.coins);
  }

  // .then((response) => response.json())
  // .then((data) => {
  //   res.status(200).send(data.data.coins);
  // })
  // .catch((err) => res.status(200).send({ error: true }));
}
